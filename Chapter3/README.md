# Chapter 3 Scripts: High-Dimensional nORF Analysis

This directory contains R scripts for the high-dimensional analysis of Novel Open Reading Frames (nORFs) presented in Chapter 3 of the thesis "The Elusive Dynamic of the Genome". The scripts cover proteochemometric (PCM) feature extraction, statistical analysis, machine learning classification, topology analysis based on predicted structures, and the development of an "nORF Kernel" score.

## Workflow Overview

The scripts are designed to be run sequentially:

1.  `01_setup_load_data.R`: Load packages and input sequences.
2.  `02_pcm_feature_extraction.R`: Calculate PCM features.
3.  `03_pcm_exploration_correlation.R`: Explore features and correlations.
4.  `04_xgboost_classification.R`: Classify nORFs vs ORFs using all features.
5.  `05_topology_analysis.R`: Analyze structural features from PDB/DSSP data.
6.  `06_norf_kernel_analysis.R`: Develop and test the nORF Kernel score using a reduced feature set.

## Input Data Requirements

To run these scripts, you will need:

*   **nORF GTF:** `nORFsDB.1.1.gtf` (or equivalent) containing nORF definitions and amino acid sequences.
*   **Canonical ORF FASTA:** `UP000005640_9606_20k.fasta` (or equivalent) containing canonical protein sequences.
*   **Random Sequences:** `1000RandomSequences.csv` (optional, will be generated if not found).
*   **PDB Directory (for Script 05):** A directory named `pdb` containing PDB files (e.g., generated by ESMFold) for the nORFs, where filenames match nORF IDs.
*   **DSSP Directory (for Script 05):** A directory named `dssp` containing DSSP output files corresponding to the PDB files in the `pdb` directory.

## Scripts

1.  **`01_setup_load_data.R`**:
    *   **Purpose:** Loads required packages and initial sequence data.
    *   **Actions:** Reads nORF GTF, canonical ORF FASTA, loads/generates random sequences, extracts sequence attributes (ID, AA sequence, start codon), optionally checks for missing PDB files, saves loaded data to `chapter3_loaded_data.RData`.
    *   **Key Output:** `chapter3_loaded_data.RData`, `nORFs_all.fasta`, `nORF_start_codon_usage.png`.

2.  **`02_pcm_feature_extraction.R`**:
    *   **Purpose:** Calculates proteochemometric (PCM) features for nORFs, canonical ORFs, and random sequences.
    *   **Actions:** Defines wrapper functions for `protr` feature extraction (e.g., `extractAAC`, `extractCTDC`, `extractPAAC`), applies these functions to the sequences loaded in script 01, handles potential errors during extraction, aggregates features.
    *   **Key Input:** `chapter3_loaded_data.RData`.
    *   **Key Output:** `nORFs_pcm_features.csv`, `ORFs_pcm_features.csv`, `Random_pcm_features.csv`.

3.  **`03_pcm_exploration_correlation.R`**:
    *   **Purpose:** Performs exploratory data analysis on the calculated PCM features.
    *   **Actions:** Loads feature CSVs, combines nORF and ORF features, calculates and plots the feature correlation matrix (`corrplot`), defines and uses `plotTripletPlot` function to compare feature distributions (density and boxplots) between nORFs, ORFs, and random sequences for selected top features.
    *   **Key Input:** `nORFs_pcm_features.csv`, `ORFs_pcm_features.csv`, `Random_pcm_features.csv`.
    *   **Key Output:** `pcm_feature_correlation_plot.png`, `feature_distribution_[feature_name].png` plots.

4.  **`04_xgboost_classification.R`**:
    *   **Purpose:** Trains and evaluates an XGBoost machine learning model to classify nORFs vs ORFs based on all PCM features.
    *   **Actions:** Loads feature CSVs, prepares data (combines, cleans NAs, creates numeric labels), splits data into training, testing, and validation sets, trains an initial XGBoost model, evaluates using confusion matrix and ROC/AUC, calculates and plots feature importance. Includes commented-out code for optional hyperparameter tuning using `caret`.
    *   **Key Input:** `nORFs_pcm_features.csv`, `ORFs_pcm_features.csv`.
    *   **Key Output:** `xgboost_norf_orf_classifier.model`, `xgboost_feature_importance.png`, `xgboost_roc_curve.png`.

5.  **`05_topology_analysis.R`**:
    *   **Purpose:** Analyzes nORF 3D structure topology using predicted structures (PDB) and secondary structure assignments (DSSP).
    *   **Actions:** Defines functions/workflow for reading PDB and DSSP files, calculates summary statistics (solvent accessibility, phi/psi angles, secondary structure element proportions), generates average and combined Ramachandran plots, plots secondary structure distributions using `ggbetweenstats`. Includes (commented out) framework for Normal Mode Analysis (NMA).
    *   **Input:** Requires PDB files in `./pdb` and corresponding DSSP output files in `./dssp`.
    *   **Key Output:** `dssp_summary_stats.csv`, `ramachandran_average.png`, `ramachandran_combined.png`, `secondary_structure_distribution.png`.

6.  **`06_norf_kernel_analysis.R`**:
    *   **Purpose:** Develops and analyzes a reduced feature set ("nORF Kernel") based on top features from the initial XGBoost model.
    *   **Actions:** Loads feature CSVs and `chapter3_loaded_data.RData` (for sequence lengths), selects specific kernel features, calculates a kernel score (sum of selected features), visualizes kernel score vs sequence length, performs PCA on kernel features, trains and evaluates a new XGBoost model using only the kernel features, outputs feature importance (including LaTeX table).
    *   **Key Input:** `nORFs_pcm_features.csv`, `ORFs_pcm_features.csv`, `chapter3_loaded_data.RData`.
    *   **Key Output:** `xgboost_norf_kernel_classifier.model`, `xgboost_kernel_importance.png`, `xgboost_kernel_roc_curve.png`, `norf_kernel_vs_length.png`, `norf_kernel_pca.png`, `xgboost_kernel_importance.tex`.

## Package Requirements

This chapter's analysis requires the following key R packages (see main `README.md` for installation guidance):

*   **Core:** `data.table`, `stringi`, `dplyr`, `tidyr`
*   **Sequence/Structure:** `Biostrings`, `protr`, `kebabs`, `bio3d`
*   **Statistics/ML:** `stats`, `caret`, `xgboost`, `pROC`
*   **Plotting:** `ggplot2`, `corrplot`, `ggpubr`, `gridExtra`, `ggExtra`, `ggstatsplot`, `RColorBrewer`, `scales`
*   **Other:** `ballgown` (for `gffRead`), `xtable` (for LaTeX output)

Ensure these are installed before running the scripts.

